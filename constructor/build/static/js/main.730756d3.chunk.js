(this.webpackJsonpconstructor=this.webpackJsonpconstructor||[]).push([[0],{505:function(e,t,c){},530:function(e,t,c){},578:function(e,t,c){},579:function(e,t,c){},580:function(e,t,c){},800:function(e,t,c){},914:function(e,t,c){},915:function(e,t,c){"use strict";c.r(t);c(504),c(505);var n=c(0),a=c.n(n),s=c(69),i=c.n(s),r=c(78),o=c(41),l=c(112),u=c(930),d=c(938),j=c(926),b=c(324),h=c.n(b),O={getAllMedia:function(){return x("http://localhost:1337/upload/files","get")},addMedia:function(e){return x("http://localhost:1337/upload/","post",e)},removeMediaById:function(e){return x("http://localhost:1337/upload/files/".concat(e),"delete")}},m={getQuests:function(){return x("http://localhost:1337/quests","get")},getQuestById:function(e){return x("http://localhost:1337/quests/".concat(e))},updateQuest:function(e,t){return x("http://localhost:1337/quests/".concat(e),"put",t)}},f={getScenes:function(){return x("http://localhost:1337/scenes","get")},getSceneById:function(e){return x("http://localhost:1337/scenes/".concat(e),"get")},updateScene:function(e,t){return x("http://localhost:1337/scenes/".concat(e),"put",t)},createScene:function(e){return x("http://localhost:1337/scenes/","post",e)},deleteScene:function(e){return x("http://localhost:1337/scenes/".concat(e),"delete")}},g=localStorage.getItem("token")||null;g&&(h.a.defaults.headers.authorization="Bearer ".concat(g));var x=function(e,t,c,n){return new Promise((function(a,s){return h()({method:t,data:c,url:e,headers:n}).then((function(e){try{a(e.data)}catch(t){a(e)}})).catch((function(e){try{s(e.response.data)}catch(t){s(e)}}))}))},p={media:O,quest:m,scene:f},S=c(493),v=c(276),N=c(939),y=c(495),T=c(935),k=c(934),w=c(933),C=c(490),I=c(491),B=c(927),E=c(937),L="SET_QUESTS",q="SET_QUEST",P="SET_SCENE",_="SET_UI",G="SET_HEADER_TEXT",M="SET_MEDIA",F=Object(E.a)(L),Q=Object(E.a)(q),A=Object(E.a)(P),z=(Object(E.a)(_),Object(E.a)(G)),D=Object(E.a)(M);c(530);var K=c(9),R=function(){var e=Object(r.b)(),t=Object(n.useState)(!1),c=Object(l.a)(t,2),a=c[0],s=c[1],i=Object(n.useState)("upgrade"),u=Object(l.a)(i,2),b=u[0],h=u[1],O=Object(n.useState)(!0),m=Object(l.a)(O,2),f=(m[0],m[1]),g=Object(n.useState)([]),x=Object(l.a)(g,2),E=x[0],L=x[1],q=T.a.TextArea,P=k.a.Option,_=w.a.useForm(),G=Object(l.a)(_,1)[0],M=Object(r.c)((function(e){return e.media})).media,F=Object(r.c)((function(e){return e.quest})),z=F.quest,D=F.scene;if(console.log("scene",D),Object(n.useEffect)((function(){s(!1);var e=[];z.Scenes.forEach((function(t){t.Buttons.forEach((function(t){t.GlobalTriggerNameSetter&&e.push(t.GlobalTriggerNameSetter)}))})),L(e)}),[D]),void 0===D||void 0===D.id)return Object(K.jsx)(d.b,{align:"center",children:Object(K.jsx)(j.a,{size:"large"})});var R={PersonName:D.PersonName,SceneName:D.SceneName,Text:D.Text,Background:D.Background?D.Background.id:"",Person:D.Person?D.Person.id:"",Music:D.Music?D.Music.id:"",Buttons:D.Buttons.map((function(e){return{Text:e.Text,Scene:e.Scene.id,GlobalTriggerNameSetter:e.GlobalTriggerNameSetter,GlobalTriggerNameGetter:e.GlobalTriggerNameGetter}}))},U=function(){return Object(K.jsxs)(d.b,{className:"config-buttons",children:[a?Object(K.jsx)(C.a,{onClick:function(){return s(!1)},children:"Preview"}):Object(K.jsx)(C.a,{onClick:function(){return s(!0)},children:"Edit"}),Object(K.jsx)(C.a,{onClick:function(){s(!0),h("new"),G.setFieldsValue({PersonName:"",SceneName:"new scene",Text:"",Background:"",Person:"",Music:"",Buttons:[]})},children:"New scene"}),Object(K.jsx)(C.a,{onClick:function(){s(!0),h("new"),G.setFieldsValue({PersonName:D.PersonName,SceneName:D.SceneName,Text:D.Text,Background:D.Background?D.Background.id:"",Person:D.Person?D.Person.id:"",Music:D.Music?D.Music.id:"",Buttons:D.Buttons.map((function(e){return{Text:e.Text,Scene:e.Scene.id,GlobalTriggerNameSetter:e.GlobalTriggerNameSetter,GlobalTriggerNameGetter:e.GlobalTriggerNameGetter}}))})},children:"Copy scene"}),Object(K.jsx)(C.a,{onClick:function(){p.scene.deleteScene(D.id).then((function(){p.quest.getQuestById(z.id).then((function(t){e(Q(t)),I.b.success("Remove success"),f(!1)})).catch((function(e){console.log(e)}))}))},children:"Remove Scene"})]})};return a?Object(K.jsxs)("div",{className:"scene-form",children:[Object(K.jsx)(U,{}),Object(K.jsxs)(w.a,{name:"scene",onFinish:function(t){console.log("Success:",t),f(!0);var c=[];t.Buttons.forEach((function(e){e.Scene&&c.push(e)}));var n=Object(o.a)(Object(o.a)({},t),{},{Buttons:c});"upgrade"===b?p.scene.updateScene(D.id,n).then((function(){h("upgrade"),p.quest.getQuestById(z.id).then((function(t){e(Q(t));var c=t.Scenes.find((function(e){return e.id.toString()===D.id.toString()}));e(A(c)),I.b.success("Save success"),f(!1)})).catch((function(e){console.log(e)}))})):p.scene.createScene(n).then((function(t){var c=Object(o.a)(Object(o.a)({},z),{},{Scenes:[].concat(Object(v.a)(z.Scenes),[t.id])});p.quest.updateQuest(z.id,c).then((function(t){e(Q(t));var c=t.Scenes.find((function(e){return e.id.toString()===D.id.toString()}));e(A(c)),I.b.success("Save success"),f(!1)})).catch((function(e){console.log(e)}))}))},form:G,onFinishFailed:function(e){console.log("Failed:",e)},layout:"vertical",initialValues:R,children:[Object(K.jsx)(w.a.Item,{label:"Scene name",name:"SceneName",children:Object(K.jsx)(T.a,{})}),Object(K.jsx)(w.a.Item,{label:"Person name",name:"PersonName",children:Object(K.jsx)(T.a,{})}),Object(K.jsx)(w.a.Item,{label:"Text",name:"Text",children:Object(K.jsx)(q,{})}),Object(K.jsx)(w.a.Item,{label:"Background Image",name:"Background",children:Object(K.jsx)(k.a,{showSearch:!0,placeholder:"Select background",optionFilterProp:"children",filterOption:function(e,t){return t.children.toLowerCase().indexOf(e.toLowerCase())>=0},filterSort:function(e,t){return e.children.toLowerCase().localeCompare(t.children.toLowerCase())},children:M.map((function(e){if("image/png"===e.mime||"image/jpeg"===e.mime)return Object(K.jsx)(P,{value:e.id,children:e.name})}))})}),Object(K.jsx)(w.a.Item,{label:"Person Image",name:"Person",children:Object(K.jsx)(k.a,{showSearch:!0,placeholder:"Select background",optionFilterProp:"children",filterOption:function(e,t){return t.children.toLowerCase().indexOf(e.toLowerCase())>=0},filterSort:function(e,t){return e.children.toLowerCase().localeCompare(t.children.toLowerCase())},children:M.map((function(e){if("image/png"===e.mime||"image/jpeg"===e.mime)return Object(K.jsx)(P,{value:e.id,children:e.name})}))})}),Object(K.jsx)(w.a.Item,{label:"Music",name:"Music",children:Object(K.jsx)(k.a,{showSearch:!0,placeholder:"Select music",optionFilterProp:"children",filterOption:function(e,t){return t.children.toLowerCase().indexOf(e.toLowerCase())>=0},filterSort:function(e,t){return e.children.toLowerCase().localeCompare(t.children.toLowerCase())},children:M.map((function(e){if("audio/mpeg"===e.mime)return Object(K.jsx)(P,{value:e.id,children:e.name})}))})}),Object(K.jsx)(w.a.List,{name:"Buttons",children:function(e,t){var c=t.add,n=t.remove;return Object(K.jsxs)(K.Fragment,{children:[e.map((function(e){var t=e.key,c=e.name,a=e.fieldKey,s=Object(S.a)(e,["key","name","fieldKey"]);return Object(K.jsxs)(K.Fragment,{children:[Object(K.jsx)(B.a,{}),Object(K.jsxs)(d.b,{align:"baseline",direction:"horizontal",children:[Object(K.jsxs)(d.b,{direction:"vertical",style:{width:"400px"},children:[Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},s),{},{name:[c,"Text"],label:"Text",fieldKey:[a,"Text"],children:Object(K.jsx)(T.a,{placeholder:"Text"})})),Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},s),{},{name:[c,"Scene"],label:"Scene name",fieldKey:[a,"Scene"],children:Object(K.jsx)(k.a,{children:z.Scenes.map((function(e){return Object(K.jsx)(P,{value:e.id,children:e.SceneName})}))})}))]}),Object(K.jsxs)(d.b,{direction:"vertical",children:[Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},s),{},{name:[c,"GlobalTriggerNameSetter"],label:"Trigger Setter",fieldKey:[a,"GlobalTriggerNameSetter"],children:Object(K.jsx)(T.a,{placeholder:"GlobalTriggerNameSetter"})})),Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},s),{},{name:[c,"GlobalTriggerNameGetter"],label:"Trigger Getter",fieldKey:[a,"GlobalTriggerNameGetter"],children:Object(K.jsx)(k.a,{children:E.map((function(e){return Object(K.jsx)(P,{value:e,children:e})}))})}))]}),Object(K.jsx)(N.a,{onClick:function(){return n(c)}})]},t)]})})),Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(C.a,{type:"dashed",onClick:function(){return c()},block:!0,icon:Object(K.jsx)(y.a,{}),children:"Add button"})})]})}}),Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(C.a,{type:"primary",htmlType:"submit",children:"Submit"})})]})]}):Object(K.jsxs)("div",{className:"scene",children:[Object(K.jsx)(U,{}),D.Background&&Object(K.jsx)("div",{className:"background",children:Object(K.jsx)("img",{className:"scene-background",src:"http://localhost:1337".concat(D.Background.url),alt:"background"})}),D.Person&&Object(K.jsx)("div",{className:"person",children:Object(K.jsx)("img",{src:"http://localhost:1337".concat(D.Person.url),alt:"person"})}),Object(K.jsxs)("div",{className:"controls-wrap",children:[Object(K.jsxs)("p",{className:"name name-right",children:[D.PersonName,Object(K.jsx)("span",{className:"name-earth",children:"_"})]}),Object(K.jsxs)("div",{className:"controls",children:[Object(K.jsx)("p",{className:"dialog",children:D.Text}),Object(K.jsx)("div",{className:"buttons",children:D.Buttons.map((function(e){return Object(K.jsx)("button",{className:"button",children:e.Text},e.Text)}))})]})]})]})},U=c(928),V=c(940),X=c(941),H=c(942),J=c(936),W=c(51),Y=function(){var e=Object(W.f)();return Object(K.jsxs)(J.a,{mode:"inline",defaultSelectedKeys:["1"],children:[Object(K.jsx)(J.a.Item,{onClick:function(){e.push("/quests")},icon:Object(K.jsx)(V.a,{}),children:"\u041a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0442\u043e\u0440"},"1"),Object(K.jsx)(J.a.Item,{onClick:function(){e.push("/deploy")},icon:Object(K.jsx)(X.a,{}),children:"\u0414\u0435\u043f\u043b\u043e\u0439"},"2"),Object(K.jsx)(J.a.Item,{onClick:function(){e.push("/resourses")},icon:Object(K.jsx)(H.a,{}),children:"\u0420\u0435\u0441\u0443\u0440\u0441\u044b"},"3")]})},Z=(c(578),function(){var e=Object(r.c)((function(e){return e.ui.header}));return Object(K.jsx)("h2",{children:e.text})}),$=(c(579),function(e){var t=e.children,c=U.a.Header,n=U.a.Sider,a=U.a.Content;return Object(K.jsxs)(U.a,{className:"layout",children:[Object(K.jsx)(n,{children:Object(K.jsx)(Y,{})}),Object(K.jsxs)(U.a,{children:[Object(K.jsx)(c,{children:Object(K.jsx)(Z,{})}),Object(K.jsx)(a,{children:t})]})]})}),ee=(c(580),function(){var e=Object(W.g)(),t=Object(r.b)(),c=Object(n.useState)(),a=Object(l.a)(c,2),s=a[0],i=a[1],b=Object(n.useState)(!0),h=Object(l.a)(b,2),O=h[0],m=h[1],f=Object(r.c)((function(e){return e.quest})).quest,g=function(e){var t=[],c=[];return e.Scenes.forEach((function(e){t.push({id:e.id.toString(),value:{title:e.SceneName}}),e.Buttons.map((function(t){c.push({source:e.id.toString(),target:t.Scene.id.toString()})}))})),{data:{nodes:t,edges:c},height:875,nodeCfg:{type:"rect",anchorPoints:[[.5,1],[.5,0]],title:{style:{fill:"#000",fontSize:12}}},edgeCfg:{type:"polyline",endArrow:{fill:"#ccc"}},layout:{rankdir:"TB"}}};return Object(n.useEffect)((function(){if(f.hasOwnProperty("Scenes")){var e=g(f);i(e)}}),[f]),Object(n.useEffect)((function(){t(z("\u0412\u0430\u0448\u0438 \u043a\u0432\u0435\u0441\u0442\u044b")),m(!0),e.questId&&p.quest.getQuestById(e.questId).then((function(e){var c=g(e);i(c),t(z("".concat(e.Name))),t(Q(e)),m(!1)})).catch((function(e){console.log(e)})),p.media.getAllMedia().then((function(e){t(D(e))}))}),[]),O?Object(K.jsx)($,{children:Object(K.jsx)("div",{className:"page page-scenes",children:Object(K.jsx)(d.b,{align:"center",children:Object(K.jsx)(j.a,{size:"large"})})})}):f?Object(K.jsx)($,{children:Object(K.jsxs)("div",{className:"page page-constructor",children:[Object(K.jsx)("div",{className:"page-map",children:Object(K.jsx)(u.a,Object(o.a)(Object(o.a)({},s),{},{onReady:function(e){e.on("node:click",(function(e){var c=e.item._cfg,n=f.Scenes.find((function(e){return e.id.toString()===c.id}));t(A(n))}))}}))}),Object(K.jsx)("div",{className:"page-scenes",children:Object(K.jsx)(R,{})})]})}):Object(K.jsx)("h2",{children:"Load"})}),te=c(943),ce=c(944),ne=c(945),ae=c(931),se=c(932),ie=c(330),re=c.n(ie),oe=c(322),le=c.n(oe),ue=(c(800),function(){var e=Object(r.b)(),t=Object(r.c)((function(e){return e.media})),c=t.media,a=t.isLoading,s=function(){p.media.getAllMedia().then((function(t){e(D(t))}))};Object(n.useEffect)((function(){e(z("\u0412\u0430\u0448\u0438 \u0432\u043b\u043e\u0436\u0435\u043d\u0438\u044f")),s()}),[]);var i={name:"files",multiple:!0,showUploadList:!1,action:"http://localhost:1337/upload/",onChange:function(e){"uploading"!==e.file.status&&console.log(e.file,e.fileList),"done"===e.file.status?(I.b.success("".concat(e.file.name," file uploaded successfully")),s()):"error"===e.file.status&&I.b.error("".concat(e.file.name," file upload failed."))}};return a?Object(K.jsx)($,{children:Object(K.jsx)("div",{className:"page page-media",children:Object(K.jsx)(d.b,{align:"center",children:Object(K.jsx)(j.a,{size:"large"})})})}):Object(K.jsx)($,{children:Object(K.jsxs)("div",{className:"page page-media",children:[Object(K.jsxs)(le.a,Object(o.a)(Object(o.a)({},i),{},{className:"media-dnd",children:[Object(K.jsx)("p",{className:"ant-upload-drag-icon",children:Object(K.jsx)(te.a,{})}),Object(K.jsx)("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"}),Object(K.jsx)("p",{className:"ant-upload-hint",children:"Support for a single or bulk upload. Strictly prohibit from uploading company data or other band files"})]})),Object(K.jsx)("div",{className:"media-gallery",children:c.map((function(e){switch(console.log(e),e.mime){case"image/jpeg":case"image/png":return Object(K.jsx)(ae.a,{style:{width:300},cover:Object(K.jsx)(se.a,{className:"media-item media-image",src:"http://localhost:1337".concat(e.url)}),className:"media-item",actions:[Object(K.jsx)(ce.a,{onClick:function(){p.media.removeMediaById(e.id).then((function(){s()}))}},"setting")],children:Object(K.jsx)(re.a,{title:"".concat(e.name)})});case"audio/mpeg":return Object(K.jsxs)(ae.a,{style:{width:300},className:"media-item",actions:[Object(K.jsx)(ce.a,{onClick:function(){p.media.removeMediaById(e.id).then((function(){s()}))}},"setting")],children:[Object(K.jsx)(ne.a,{}),Object(K.jsx)(re.a,{title:"".concat(e.name)})]})}return e.name}))})]})})}),de=c(946),je=c(947),be=c(275),he=(c(914),function(){var e=Object(r.b)(),t=Object(r.c)((function(e){return e.quest})),c=t.quests,a=t.isLoading;return Object(n.useEffect)((function(){e(z("\u0412\u0430\u0448\u0438 \u043a\u0432\u0435\u0441\u0442\u044b")),p.quest.getQuests().then((function(t){e(F(t)),e(z("\u0412\u0430\u0448\u0438 \u043a\u0432\u0435\u0441\u0442\u044b (".concat(t.length,")")))})).catch((function(e){console.log(e)}))}),[]),a?Object(K.jsx)($,{children:Object(K.jsx)("div",{className:"page page-quests",children:Object(K.jsx)(d.b,{align:"center",children:Object(K.jsx)(j.a,{size:"large"})})})}):Object(K.jsx)($,{children:Object(K.jsx)("div",{className:"page page-quests",children:Object(K.jsx)(d.b,{direction:"vertical",children:c.map((function(e){return Object(K.jsxs)(ae.a,{title:e.Name,extra:Object(K.jsx)(be.b,{to:"/constructor/".concat(e.id),children:"\u041e\u0442\u043a\u0440\u044b\u0442\u044c"}),className:"quest",children:[Object(K.jsxs)("p",{children:["\u0421\u0446\u0435\u043d: ",e.Scenes.length]}),Object(K.jsxs)("p",{children:["\u0413\u043b\u043e\u0431\u0430\u043b\u044c\u043d\u044b\u0435 \u0441\u0442\u0438\u043b\u0438:",e.DefaultStyles?Object(K.jsx)(de.a,{}):Object(K.jsx)(je.a,{})]}),Object(K.jsxs)("p",{children:["\u0414\u0430\u0442\u0430 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f: ",e.created_at]}),Object(K.jsxs)("p",{children:["\u0414\u0430\u0442\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f: ",e.updated_at]}),Object(K.jsxs)("p",{children:["\u0414\u0430\u0442\u0430 \u043f\u0443\u0431\u043b\u0438\u043a\u0430\u0446\u0438\u0438: ",e.published_at]})]},e.id)}))})})})}),Oe=function(){return Object(K.jsx)(be.a,{children:Object(K.jsxs)(W.c,{children:[Object(K.jsx)(W.a,{path:["/","/quests","/deploy"],exact:!0,component:he}),Object(K.jsx)(W.a,{path:["/constructor/:questId"],exact:!0,component:ee}),Object(K.jsx)(W.a,{path:["/resourses"],exact:!0,component:ue})]})})},me=c(277),fe={isLoading:!0,media:[],error:null},ge={isLoading:!0,quests:[],quest:{},scene:{},error:null},xe={isLoading:!0,header:{text:""},error:null},pe=Object(me.a)({media:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:fe,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case M:return Object(o.a)(Object(o.a)({},e),{},{isLoading:!1,media:t.payload});default:return e}},quest:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ge,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case L:return Object(o.a)(Object(o.a)({},e),{},{isLoading:!1,quests:t.payload});case q:return Object(o.a)(Object(o.a)({},e),{},{isLoading:!1,quest:t.payload});case P:return Object(o.a)(Object(o.a)({},e),{},{isLoading:!1,scene:t.payload});default:return e}},ui:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:xe,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case _:return Object(o.a)(Object(o.a)({},e),{},{isLoading:!1},t.payload);case G:return Object(o.a)(Object(o.a)({},e),{},{isLoading:!1,header:{text:t.payload}});default:return e}}}),Se=Object(me.b)(pe,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__());i.a.render(Object(K.jsxs)(a.a.StrictMode,{children:[Object(K.jsx)(r.a,{store:Se,children:Object(K.jsx)(Oe,{})}),","]}),document.getElementById("root"))}},[[915,1,2]]]);
//# sourceMappingURL=main.730756d3.chunk.js.map